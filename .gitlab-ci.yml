stages:
  - lint
  - test

# -----------------------------
# 基础模板（不会被当作 job 执行）
# -----------------------------
.base_ci:
  image: python:3.12.12-slim
  variables:
    PYTHONDONTWRITEBYTECODE: "1"
    PYTHONUNBUFFERED: "1"

    # Tencent PyPI mirror
    PIP_INDEX_URL: "https://mirrors.cloud.tencent.com/pypi/simple"
    PIP_TRUSTED_HOST: "mirrors.cloud.tencent.com"

    # uv cache
    UV_CACHE_DIR: "$CI_PROJECT_DIR/.cache/uv"

  cache:
    key: "uv-cache"
    paths:
      - .cache/uv

  before_script:
    - python --version
    - pip install -U pip
    - pip install uv
    - uv --version
    - uv pip install -r requirements-dev.txt

# -----------------------------
# Lint job
# -----------------------------
lint:
  extends: .base_ci
  stage: lint
  script:
    - ruff --version
    - ruff check .

# -----------------------------
# Test job
# -----------------------------
test:
  extends: .base_ci
  stage: test
  script:
    - python scripts/run_quick_checks.py
