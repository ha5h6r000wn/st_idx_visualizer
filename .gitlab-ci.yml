stages:
  - lint
  - test

default:
  image: python:3.12.12-slim
  variables:
    # ---- Python / CI 基础 ----
    PYTHONDONTWRITEBYTECODE: "1"
    PYTHONUNBUFFERED: "1"

    # ---- Tencent PyPI mirror (for uv/pip) ----
    PIP_INDEX_URL: "https://mirrors.cloud.tencent.com/pypi/simple"
    PIP_TRUSTED_HOST: "mirrors.cloud.tencent.com"

    # ---- uv cache ----
    UV_CACHE_DIR: "$CI_PROJECT_DIR/.cache/uv"

  cache:
    key: "uv-cache"
    paths:
      - .cache/uv

  before_script:
    - python --version
    - pip install -U pip
    - pip install uv
    - uv --version
    # 安装 dev 依赖（以 requirements-dev.txt 为准）
    - uv pip install -r requirements-dev.txt

lint:
  stage: lint
  script:
    - ruff --version
    - ruff check .

test:
  stage: test
  script:
    - python scripts/run_quick_checks.py
